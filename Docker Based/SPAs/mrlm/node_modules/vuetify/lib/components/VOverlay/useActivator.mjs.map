{"version":3,"file":"useActivator.mjs","names":["VMenuSymbol","makeDelayProps","useDelay","computed","effectScope","inject","nextTick","onScopeDispose","ref","watch","watchEffect","getCurrentInstance","IN_BROWSER","propsFactory","refElement","SUPPORTS_FOCUS_VISIBLE","makeActivatorProps","activator","String","Object","activatorProps","type","default","openOnClick","Boolean","undefined","openOnHover","openOnFocus","closeOnContentClick","useActivator","props","_ref","isActive","isTop","activatorEl","isHovered","isFocused","firstEnter","value","runOpenDelay","runCloseDelay","availableEvents","click","e","stopPropagation","currentTarget","target","mouseenter","sourceCapabilities","firesTouchEvents","mouseleave","focus","matches","blur","activatorEvents","events","contentEvents","menu","closeParents","scrimEvents","val","activatorRef","vm","scope","run","_useActivator","stop","flush","immediate","_ref2","oldVal","getActivator","unbindActivatorProps","bindActivatorProps","el","arguments","length","_props","entries","forEach","_ref3","name","cb","addEventListener","keys","k","removeAttribute","setAttribute","_ref4","removeEventListener","selector","proxy","$el","parentNode","hasAttribute","document","querySelector","nodeType","Node","ELEMENT_NODE"],"sources":["../../../src/components/VOverlay/useActivator.tsx"],"sourcesContent":["// Components\nimport { VMenuSymbol } from '@/components/VMenu/shared'\n\n// Composables\nimport { makeDelayProps, useDelay } from '@/composables/delay'\n\n// Utilities\nimport {\n  computed,\n  effectScope,\n  inject,\n  nextTick,\n  onScopeDispose,\n  ref,\n  watch,\n  watchEffect,\n} from 'vue'\nimport {\n  getCurrentInstance,\n  IN_BROWSER,\n  propsFactory,\n  refElement,\n  SUPPORTS_FOCUS_VISIBLE,\n} from '@/util'\n\n// Types\nimport type {\n  ComponentInternalInstance,\n  ComponentPublicInstance,\n  EffectScope,\n  PropType,\n  Ref,\n} from 'vue'\nimport type { DelayProps } from '@/composables/delay'\n\ninterface ActivatorProps extends DelayProps {\n  activator?: 'parent' | string | Element | ComponentPublicInstance\n  activatorProps: Record<string, any>\n\n  openOnClick: boolean | undefined\n  openOnHover: boolean\n  openOnFocus: boolean | undefined\n\n  closeOnContentClick: boolean\n}\n\nexport const makeActivatorProps = propsFactory({\n  activator: [String, Object] as PropType<ActivatorProps['activator']>,\n  activatorProps: {\n    type: Object as PropType<ActivatorProps['activatorProps']>,\n    default: () => ({}),\n  },\n\n  openOnClick: {\n    type: Boolean,\n    default: undefined,\n  },\n  openOnHover: Boolean,\n  openOnFocus: {\n    type: Boolean,\n    default: undefined,\n  },\n\n  closeOnContentClick: Boolean,\n\n  ...makeDelayProps(),\n}, 'VOverlay-activator')\n\nexport function useActivator (\n  props: ActivatorProps,\n  { isActive, isTop }: { isActive: Ref<boolean>, isTop: Ref<boolean> }\n) {\n  const activatorEl = ref<HTMLElement>()\n\n  let isHovered = false\n  let isFocused = false\n  let firstEnter = true\n\n  const openOnFocus = computed(() => props.openOnFocus || (props.openOnFocus == null && props.openOnHover))\n  const openOnClick = computed(() => props.openOnClick || (props.openOnClick == null && !props.openOnHover && !openOnFocus.value))\n\n  const { runOpenDelay, runCloseDelay } = useDelay(props, value => {\n    if (\n      value === (\n        (props.openOnHover && isHovered) ||\n        (openOnFocus.value && isFocused)\n      ) && !(props.openOnHover && isActive.value && !isTop.value)\n    ) {\n      if (isActive.value !== value) {\n        firstEnter = true\n      }\n      isActive.value = value\n    }\n  })\n\n  const availableEvents = {\n    click: (e: MouseEvent) => {\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      isActive.value = !isActive.value\n    },\n    mouseenter: (e: MouseEvent) => {\n      if (e.sourceCapabilities?.firesTouchEvents) return\n\n      isHovered = true\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      runOpenDelay()\n    },\n    mouseleave: (e: MouseEvent) => {\n      isHovered = false\n      runCloseDelay()\n    },\n    focus: (e: FocusEvent) => {\n      if (\n        SUPPORTS_FOCUS_VISIBLE &&\n        !(e.target as HTMLElement).matches(':focus-visible')\n      ) return\n\n      isFocused = true\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n\n      runOpenDelay()\n    },\n    blur: (e: FocusEvent) => {\n      isFocused = false\n      e.stopPropagation()\n\n      runCloseDelay()\n    },\n  }\n\n  const activatorEvents = computed(() => {\n    const events: Partial<typeof availableEvents> = {}\n\n    if (openOnClick.value) {\n      events.click = availableEvents.click\n    }\n    if (props.openOnHover) {\n      events.mouseenter = availableEvents.mouseenter\n      events.mouseleave = availableEvents.mouseleave\n    }\n    if (openOnFocus.value) {\n      events.focus = availableEvents.focus\n      events.blur = availableEvents.blur\n    }\n\n    return events\n  })\n\n  const contentEvents = computed(() => {\n    const events: Partial<typeof availableEvents> = {}\n\n    if (props.openOnHover) {\n      events.mouseenter = () => {\n        isHovered = true\n        runOpenDelay()\n      }\n      events.mouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    if (props.closeOnContentClick) {\n      const menu = inject(VMenuSymbol, null)\n      events.click = () => {\n        isActive.value = false\n        menu?.closeParents()\n      }\n    }\n\n    return events\n  })\n\n  const scrimEvents = computed(() => {\n    const events: Partial<typeof availableEvents> = {}\n    if (props.openOnHover) {\n      events.mouseenter = () => {\n        if (firstEnter) {\n          isHovered = true\n          firstEnter = false\n          runOpenDelay()\n        }\n      }\n      events.mouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    return events\n  })\n\n  watch(isTop, val => {\n    if (val && (\n      (props.openOnHover && !isHovered && (!openOnFocus.value || !isFocused)) ||\n      (openOnFocus.value && !isFocused && (!props.openOnHover || !isHovered))\n    )) {\n      isActive.value = false\n    }\n  })\n\n  const activatorRef = ref()\n  watchEffect(() => {\n    if (!activatorRef.value) return\n\n    nextTick(() => {\n      activatorEl.value = refElement(activatorRef.value)\n    })\n  })\n\n  const vm = getCurrentInstance('useActivator')\n  let scope: EffectScope\n  watch(() => !!props.activator, val => {\n    if (val && IN_BROWSER) {\n      scope = effectScope()\n      scope.run(() => {\n        _useActivator(props, vm, { activatorEl, activatorEvents })\n      })\n    } else if (scope) {\n      scope.stop()\n    }\n  }, { flush: 'post', immediate: true })\n\n  onScopeDispose(() => {\n    scope?.stop()\n  })\n\n  return { activatorEl, activatorRef, activatorEvents, contentEvents, scrimEvents }\n}\n\nfunction _useActivator (\n  props: ActivatorProps,\n  vm: ComponentInternalInstance,\n  { activatorEl, activatorEvents }: Pick<ReturnType<typeof useActivator>, 'activatorEl' | 'activatorEvents'>\n) {\n  watch(() => props.activator, (val, oldVal) => {\n    if (oldVal && val !== oldVal) {\n      const activator = getActivator(oldVal)\n      activator && unbindActivatorProps(activator)\n    }\n    if (val) {\n      nextTick(() => bindActivatorProps())\n    }\n  }, { immediate: true })\n\n  watch(() => props.activatorProps, () => {\n    bindActivatorProps()\n  })\n\n  onScopeDispose(() => {\n    unbindActivatorProps()\n  })\n\n  function bindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    Object.entries(activatorEvents.value).forEach(([name, cb]) => {\n      el.addEventListener(name, cb as (e: Event) => void)\n    })\n\n    Object.keys(_props).forEach(k => {\n      if (_props[k] == null) {\n        el.removeAttribute(k)\n      } else {\n        el.setAttribute(k, _props[k])\n      }\n    })\n  }\n\n  function unbindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    Object.entries(activatorEvents.value).forEach(([name, cb]) => {\n      el.removeEventListener(name, cb as (e: Event) => void)\n    })\n\n    Object.keys(_props).forEach(k => {\n      el.removeAttribute(k)\n    })\n  }\n\n  function getActivator (selector = props.activator): HTMLElement | undefined {\n    let activator\n    if (selector) {\n      if (selector === 'parent') {\n        let el = vm?.proxy?.$el?.parentNode\n        while (el.hasAttribute('data-no-activator')) {\n          el = el.parentNode\n        }\n        activator = el\n      } else if (typeof selector === 'string') {\n        // Selector\n        activator = document.querySelector(selector)\n      } else if ('$el' in selector) {\n        // Component (ref)\n        activator = selector.$el\n      } else {\n        // HTMLElement | Element\n        activator = selector\n      }\n    }\n\n    // The activator should only be a valid element (Ignore comments and text nodes)\n    activatorEl.value = activator?.nodeType === Node.ELEMENT_NODE ? activator : null\n\n    return activatorEl.value\n  }\n}\n"],"mappings":"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"}